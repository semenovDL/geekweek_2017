# Микросервисы

Когда и зачем

---

## Обо мне

<div style="display: flex; justify-content: center; align-items: center;">
  <img src="https://avatars2.githubusercontent.com/u/2780315?s=460&v=4" style="border-radius: 50%; border-width: 0; width: 200px; height: 200px;">
  <span style="width: 32px"></span>
  <span>Алексей Кузнецов</span>
</div>

- 6 лет опыта продакшен разработки
- последние 1.5 года - портал GeekBrains
- специализация: бекенд

---

## Вначале был монолит

--

#### Плюсы

- скорость разработки
  - просто добавлять новый функционал
  - просто рефакторить и изменять код
  - просто развернуть приложение

--

#### Минусы

- растущая со временем сложность
  - только логическое разграничение функционала
  - протекающие абстракции
  - рефакторинг кода затруднен
- временные издержки
  - больше кода
  - больше тестов
  - дольше деплой

---

## Микросервисы

--

#### Плюсы

- жесткое разграничение функционала
  - каждый микросервис выполняет одну задачу
  - проще тестировать
  - проще поддерживать
- больше возможностей для масштабирования
- проще разрабатывать на больших проектах

--

#### Минусы

- организация взаимодействия между сервисами
  - описание протоколов до разработки
  - поддержка нескольких версий
- сложнее конфигурировать деплой
- сложнее настроить мониторинг и сбор логов
- больше точек отказа
- шаринг структуры данных

---

## Когда использовать микросервисы

- ожидается большая нагрузка
- необходимо разрабатывать и обновлять части приложения независимо друг от друга
- разработчики хотят спать по ночам

--

## А если нужно здесь и сейчас

Пишем монолит. По возможности организуем код так, чтобы компоненты системы можно было достаточно легко отделить в будущем.

---

## Распилим монолит

Кандидаты на вынос в микросервисы

- сервис авторизации
- сервисы коммуникации (чат)
- сервисы аналитики/агрегации данных

Перед тем, как отделять сервис, подумайте, что вам это даст.

Уменьшая сложность компонентов вы увеличиваете сложность взаимодействия между ними.

---

## Как запускать

Docker, Docker или Docker?

---

## Как общаться между собой

- API (json+rest)
- RPC (gRPC + protobuf)
- Message brokers
  - RabbitMQ
  - Apache Kafka
  - Redis?
- Auth (JWT)

---

## А что насчет VCS

- каждый сервис в своем репозитории
- монорепозиторий с набором сервисов
- микросервисы в рамках одного приложения (Umbrella application (elixir), Hanami (ruby))

---

## Микросервисы - не серебряная пуля

---

### Контакты

https://github.com/semenovDL
http://telegram.me/semenovDL

---

### Ссылки

--

#### Docker

[Docker](https://www.docker.com)

--

[gRPC](https://grpc.io)

[Protobuf](https://developers.google.com/protocol-buffers/)

--

#### Очереди

[RabbitMQ](https://www.rabbitmq.com)

[Apache Kafka](https://kafka.apache.org)

[Redis](https://redis.io)

[Use Redis as message broker](https://redis.io/topics/pubsub)

--

#### Авторизация

[JWT](https://jwt.io)

--

#### Umbrella

[Umbrella in Elixir](https://elixirschool.com/en/lessons/advanced/umbrella-projects)

[Umbrella in Hanami](http://hanamirb.org/guides/1.1/architecture/overview/)

--

#### System Design

Гайд по дизайну масштабируемых систем

[en](https://github.com/donnemartin/system-design-primer)
[ru](https://docs.google.com/document/d/1w3qb6SS1Hycyce5Fg5mVMdzkGYXTRskSf57IoD98ZQw/edit)
